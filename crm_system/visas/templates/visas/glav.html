<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–ª–∞–≤–Ω–∞—è</title>
    {% load static %}
    {% load group_tags %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9fafb;
        }

        .sidebar {
            width: 80px;
            background-color: #e8f1f9;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            position: fixed;
            left: 0;
            top: 0;
        }

        .sidebar a {
    margin: 15px 0;
    color: #333;
    font-size: 20px;
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    border-radius: 12px;
    transition: background 0.3s;
    position: relative;
}

.sidebar a img {
    width: 40px;
    height: 40px;
    margin-bottom: 5px; 
}

.sidebar a span {
    font-size: 12px;
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    color: #333;
}

.sidebar a:hover {
    background: #d0e2f2;
}

.sidebar a:hover span {
    color: #007bff;
}


        .content-container {
            margin-left: 100px;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            background-color: #4a90e2;  
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background-color: #357abd;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .dashboard-item {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
        }

        .item-header {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .online-tracking {
            background-color: #d1e7dd;
        }

        .tech-inspections {
            background-color: #f8d7da;
        }

        .visas {
            background-color: #fff3cd;
        }

        .insurances {
            background-color: #cfe2f3;
        }

        .status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            display: inline-block;
            width: auto;
        }

        .status.red { background-color: #f44336; color: white; }
        .status.green { background-color: #4caf50; color: white; }
        .status.yellow { background-color: #ffeb3b; color: black; }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            text-align: left;
            vertical-align: middle;
        }

        th {
            width: 25%;
        }

        td {
            width: 25%;
            word-wrap: break-word;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .check-status {
            background-color: #f44336;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
        }

        tr {
            margin-bottom: 10px;
        }

        .clickable {
            cursor: pointer;
            color: #000000;
        }

        .clickable:hover {
            text-decoration: underline;
            color: #007bff;
        }
        .full-width {
    grid-column: span 2; 
}
    </style>
</head>
<body>

    <div class="sidebar">
        <a href="{% url 'glav' %}">
            <img src="{% static 'images/homepage_icon.png' %}" alt="–ì–ª–∞–≤–Ω–∞—è">
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </a>
        {% if request.user|has_group:"–î–∏—Å–ø–µ—Ç—á–µ—Ä" or request.user.is_superuser %}
        <a href="{% url 'index' %}">
            <img src="{% static 'images/people_icon.png' %}" alt="–õ—é–¥–∏ –∏ –ú–∞—à–∏–Ω—ã">
            <span>–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</span>
        </a>
        {% endif %}
        {% if request.user|has_group:"–õ–æ–≥–∏—Å—Ç" or request.user.is_superuser %}
        <a href="{% url 'applications' %}">
            <img src="{% static 'images/documents-icon.png' %}" alt="–î–æ–∫—É–º–µ–Ω—Ç—ã">
            <span>–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫</span>
        </a>
        {% endif %}
        {% if request.user|has_group:"–ú–µ–Ω–µ–¥–∂–µ—Ä" or request.user.is_superuser %}
        <a href="{% url 'tracking_list' %}">
            <img src="{% static 'images/gps_icon.png' %}" alt="–û–Ω–ª–∞–π–Ω —Ç—Ä–µ–∫–∏–Ω–≥">
            <span>–¢—Ä–µ–∫–∏–Ω–≥</span>
        </a>
        {% endif %}
    </div>
    

    <div class="content-container">

        <div class="header" style="display: flex; align-items: center; justify-content: space-between;">
    <div style="display: flex; align-items: center; gap: 15px;">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</h1>
        {% if request.user.is_authenticated %}
        <form method="post" action="{% url 'logout' %}" style="margin: 0;">
            {% csrf_token %}
            <button type="submit" class="btn">–í—ã–π—Ç–∏</button>
        </form>
        {% endif %}
    </div>
    {% if request.user.is_superuser %}
    <div style="display: flex; gap: 10px;">
        <a href="{% url 'add_user' %}" class="btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>
        <a href="{% url 'user_list' %}" class="btn">üë• –ú–æ–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
    </div>
    {% endif %}
</div>

        <div class="dashboard">

        {% if request.user|has_group:"–ú–µ–Ω–µ–¥–∂–µ—Ä" or request.user.is_superuser %}
         <div class="dashboard-item online-tracking {% if request.user|has_group:'–ú–µ–Ω–µ–¥–∂–µ—Ä' and not request.user.is_superuser %}full-width{% endif %}">
        <h3 class="item-header">–û–Ω–ª–∞–π–Ω —Ç—Ä–µ–∫–∏–Ω–≥</h3>
        {% if online_tracking %}
        <table>
            <thead>
                <tr>
                    <th>–ù–æ–º–µ—Ä –º–∞—à–∏–Ω—ã</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏</th>
                </tr>
            </thead>
            <tbody>
                {% for tracking in online_tracking %}
                    {% if tracking.status == '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ' %}
                    <tr>
                        <td class="clickable" onclick="window.location.href='{% url 'tracking_detail' tracking.pk %}'">{{ tracking.vehicle.number }}</td>
                        <td class="status red">{{ tracking.status }}</td>
                        <td>{{ tracking.created_at|date:"d/m/Y" }}</td>
                    </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–Ω–ª–∞–π–Ω —Ç—Ä–µ–∫–∏–Ω–≥–∞.</p>
        {% endif %}
    </div>
{% endif %}

            {% if request.user|has_group:"–î–∏—Å–ø–µ—Ç—á–µ—Ä" or request.user.is_superuser %}
            <div class="dashboard-item tech-inspections">
                <h3 class="item-header">–¢–µ—Ö–æ—Å–º–æ—Ç—Ä—ã</h3>

                <div class="dashboard-item tech-inspections">
                    <h3 class="item-header">–ü—Ä–∏—Ü–µ–ø—ã</h3>
                    {% if trailer_inspections %}
                    <table>
                        <thead>
                            <tr>
                                <th>–ù–æ–º–µ—Ä</th>
                                <th>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for inspection in trailer_inspections %}
                                {% if inspection.inspection_status == 'yellow' or inspection.inspection_status == 'red' %}
                                <tr>
                                    <td class="clickable" onclick="window.location.href='{% url 'trailer_inspection_list' %}'">{{ inspection.trailer_number }}</td>
                                    <td>{{ inspection.inspection_expiry_date|date:"d/m/Y" }}</td>
                                    <td class="status {% if inspection.inspection_status == 'red' %}red{% else %}yellow{% endif %}">
                                        {% if inspection.status != 'green' %}–ü—Ä–æ–≤–µ—Ä–∏—Ç—å!{% else %}{{ inspection.inspection_status }}{% endif %}
                                    </td>
                                </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Ö–æ—Å–º–æ—Ç—Ä–æ–≤ –ø—Ä–∏—Ü–µ–ø–æ–≤.</p>
                    {% endif %}
                </div>
                

                <div class="dashboard-item tech-inspections">
                    <h3 class="item-header">–¢—è–≥–∞—á–∏</h3>
                    {% if truck_inspections %}
                    <table>
                        <thead>
                            <tr>
                                <th>–ù–æ–º–µ—Ä</th>
                                <th>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for inspection in truck_inspections %}
                                {% if inspection.inspection_status == 'yellow' or inspection.inspection_status == 'red' %}
                                <tr>
                                    <td class="clickable" onclick="window.location.href='{% url 'truck_inspection_list' %}'">{{ inspection.truck_number }}</td>
                                    <td>{{ inspection.inspection_expiry_date|date:"d/m/Y" }}</td>
                                    <td class="status {% if inspection.inspection_status == 'red' %}red{% else %}yellow{% endif %}">
                                        {% if inspection.status != 'green' %}–ü—Ä–æ–≤–µ—Ä–∏—Ç—å!{% else %}{{ inspection.inspection_status }}{% endif %}
                                    </td>
                                </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Ö–æ—Å–º–æ—Ç—Ä–æ–≤ —Ç—è–≥–∞—á–µ–π.</p>
                    {% endif %}
                </div>
            </div>

            <div class="dashboard-item visas">
                <h3 class="item-header">–í–∏–∑—ã</h3>
                {% if visas %}
                <table>
                    <thead>
                        <tr>
                            <th>–ò–º—è</th>
                            <th>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for visa in visas %}
                            {% if visa.visa_status == 'yellow' or visa.visa_status == 'red' %}
                            <tr>
                                <td class="clickable" onclick="window.location.href='{% url 'visa_list' %}'">{{ visa.person.full_name }}</td>
                                <td>{{ visa.visa_expiry_date|date:"d/m/Y" }}</td>
                                <td class="status {% if visa.visa_status == 'red' %}red{% else %}yellow{% endif %}">
                                    {% if visa.visa_status != 'green' %}–ü—Ä–æ–≤–µ—Ä–∏—Ç—å!{% else %}{{ visa.visa_status }}{% endif %}
                                </td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∏–∑.</p>
                {% endif %}
            </div>

            <div class="dashboard-item insurances">
                <h3 class="item-header">–°—Ç—Ä–∞—Ö–æ–≤–∫–∏</h3>

                <div class="dashboard-item insurances">
                    <h3 class="item-header">–ü—Ä–∏—Ü–µ–ø—ã</h3>
                    {% if trailer_insurances %}
                    <table>
                        <thead>
                            <tr>
                                <th>–ù–æ–º–µ—Ä</th>
                                <th>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for insurance in trailer_insurances %}
                                {% if insurance.insurance_status == 'yellow' or insurance.insurance_status == 'red' %}
                                <tr>
                                    <td class="clickable" onclick="window.location.href='{% url 'trailer_insurance_list' %}'">{{ insurance.trailer_number }}</td>
                                    <td>{{ insurance.insurance_expiry_date|date:"d/m/Y" }}</td>
                                    <td class="status {% if insurance.insurance_status == 'red' %}red{% else %}yellow{% endif %}">
                                        {% if insurance.insurance_status != 'green' %}–ü—Ä–æ–≤–µ—Ä–∏—Ç—å!{% else %}{{ insurance.insurance_status }}{% endif %}
                                    </td>
                                </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç—Ä–∞—Ö–æ–≤–æ–∫ –ø—Ä–∏—Ü–µ–ø–æ–≤.</p>
                    {% endif %}
                </div>

                <div class="dashboard-item insurances">
                    <h3 class="item-header">–¢—è–≥–∞—á–∏</h3>
                    {% if truck_insurances %}
                    <table>
                        <thead>
                            <tr>
                                <th>–ù–æ–º–µ—Ä</th>
                                <th>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for insurance in truck_insurances %}
                                {% if insurance.insurance_status == 'yellow' or insurance.insurance_status == 'red' %}
                                <tr>
                                    <td class="clickable" onclick="window.location.href='{% url 'truck_insurance_list' %}'">{{ insurance.truck_number }}</td>
                                    <td>{{ insurance.insurance_expiry_date|date:"d/m/Y" }}</td>
                                    <td class="status {% if insurance.insurance_status == 'red' %}red{% else %}yellow{% endif %}">
                                        {% if insurance.insurance_status != 'green' %}–ü—Ä–æ–≤–µ—Ä–∏—Ç—å!{% else %}{{ insurance.insurance_status }}{% endif %}
                                    </td>
                                </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç—Ä–∞—Ö–æ–≤–æ–∫ —Ç—è–≥–∞—á–µ–π.</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            {% if request.user|has_group:"–õ–æ–≥–∏—Å—Ç" or request.user.is_superuser %}
    <div class="dashboard-item online-tracking {% if request.user|has_group:'–õ–æ–≥–∏—Å—Ç' and not request.user.is_superuser %}full-width{% endif %}">
        <h3 class="item-header">–ó–∞—è–≤–∫–∏:</h3>
        {% if applications %}
        <table>
            <thead>
                <tr>
                    <th>–ì—Ä—É–∑</th>
                    <th>–ü—É–Ω–∫—Ç –ø–æ–≥—Ä—É–∑–∫–∏</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ö–æ–Ω—Ç–∞–∫—Ç</th>
                </tr>
            </thead>
            <tbody>
                {% for app in applications %}
                <tr>
                    <td class="clickable" onclick="window.location.href='{% url 'preview_request' app.id %}'">
                        {{ app.cargo_name|default:"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è" }}
                    </td>
                    <td>{{ app.loading_address|default:"-"|truncatewords:5 }}</td>
                    <td>{{ app.loading_date|date:"d/m/Y" }}</td>
                    <td>{{ app.sender_contact|default:"-" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫.</p>
        {% endif %}
    </div>
{% endif %}


        </div>
    </div>
</body>
</html>
